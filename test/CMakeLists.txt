cmake_minimum_required(VERSION 3.12)

add_definitions(-DMOCK_PICO_PI)

project(tests)

set(CMAKE_C_STANDARD 23)
set(CMAKE_CXX_STANDARD 23)

find_package(Catch2 REQUIRED)

include_directories(../include ../CircularBuffer)

add_executable(tests
        ../BLE/BleConnection.cpp
        ../BLE/BleConnectionTracker.cpp
        ../Bitchat/ProtocolWriter.cpp
        ../Bitchat/PacketBase.cpp
        ../Bitchat/Peer.cpp
        ../Bitchat/ProtocolProcessor.cpp
        ../Bitchat/BinaryReader.cpp
        ../Bitchat/BinaryWriter.cpp
        ../Bitchat/Message.cpp
        ../Bitchat/Announce.cpp
        ../Bitchat/PacketPassAlong.cpp
        pico_pi_mocks.cpp
        test_bitchat_read.cpp
        test_ble_connection_tracker.cpp
        test_circular_buffer.cpp
)

target_link_libraries(tests PRIVATE
        Catch2::Catch2WithMain
        libdeflate_static
)

include(CTest)
include(Catch)
catch_discover_tests(tests)

add_subdirectory(../modules/libdeflate libdeflate)